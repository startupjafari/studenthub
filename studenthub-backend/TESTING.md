# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Auth Module

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤—Å–µ—Ö API endpoints Auth Module.

## üìã –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit Tests
–¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –º–µ—Ç–æ–¥—ã:
- `src/modules/auth/services/password.service.spec.ts` - PasswordService
- `src/modules/auth/auth.service.spec.ts` - AuthService

### 2. Integration Tests
–¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:
- `test/auth-integration.e2e-spec.ts` - –ü–æ–ª–Ω—ã–µ —Ñ–ª–æ—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 3. E2E Tests
–¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤—Å–µ API endpoints:
- `test/auth.e2e-spec.ts` - –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã endpoints
- `test/auth-complete.e2e-spec.ts` - –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö endpoints

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
npm run test
npm run test:e2e
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```bash
npm run test:cov
```

### –í —Ä–µ–∂–∏–º–µ watch
```bash
npm run test:watch
```

### –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤
```bash
npm run test:debug
```

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### E2E —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (email, password)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –õ–æ–≥–∏–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ credentials
- ‚úÖ –õ–æ–≥–∏–Ω —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ credentials
- ‚úÖ –õ–æ–≥–∏–Ω —Å –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–º email
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token
- ‚úÖ Logout –∏ logout-all

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
- ‚úÖ –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
- ‚úÖ –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ –∫–æ–¥—É
- ‚úÖ –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (protected)

#### 2FA
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 2FA —Å–µ–∫—Ä–µ—Ç–∞ –∏ QR –∫–æ–¥–∞
- ‚úÖ –í–∫–ª—é—á–µ–Ω–∏–µ 2FA
- ‚úÖ –õ–æ–≥–∏–Ω —Å 2FA
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ 2FA

#### Rate Limiting
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –ª–æ–≥–∏–Ω–∞
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π

## üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```typescript
it('should register a new user', async () => {
  const response = await request(app.getHttpServer())
    .post('/api/auth/register')
    .send({
      email: 'test@test.com',
      password: 'TestPass123',
      firstName: 'Test',
      lastName: 'User',
    })
    .expect(201);
    
  expect(response.body).toHaveProperty('message');
});
```

### –¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞
```typescript
it('should login with correct credentials', async () => {
  const response = await request(app.getHttpServer())
    .post('/api/auth/login')
    .send({
      email: 'test@test.com',
      password: 'TestPass123',
    })
    .expect(200);
    
  expect(response.body).toHaveProperty('accessToken');
  expect(response.body).toHaveProperty('refreshToken');
});
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã:

- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Edge cases
- ‚úÖ Security –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ Rate limiting

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- –¢–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `TEST_DATABASE_URL`)
- –¢–µ—Å—Ç–æ–≤—ã–π Redis (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `TEST_REDIS_HOST`)
- –ú–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (email)

## üìà –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

```bash
npm run test:cov
```

–û—Ç—á–µ—Ç –±—É–¥–µ—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `coverage/`.

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

–ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

## ‚úÖ –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º:

```bash
npm run test && npm run test:e2e
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ pre-commit hook (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å husky).

