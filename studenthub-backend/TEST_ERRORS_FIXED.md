# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö

## üìã –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **2FA –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 500 –≤–º–µ—Å—Ç–æ 400**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –æ–±—ã—á–Ω—ã–µ `Error` –≤–º–µ—Å—Ç–æ HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏–π
   - –†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
     - `TwoFactorAlreadyEnabledException` (400)
     - `TwoFactorNotEnabledException` (400)
     - `TwoFactorSetupExpiredException` (400)

2. **–¢–µ—Å—Ç —Å –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–º email –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –≤–º–µ—Å—Ç–æ 403**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π hash –ø–∞—Ä–æ–ª—è
   - –†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º bcrypt hash

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ logout-all —Ç–µ—Å—Ç–µ**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **Refresh token —Ç–µ—Å—Ç –æ–∂–∏–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω**
   - –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–µ–º –∂–µ, –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ
   - –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞

### ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):

1. **Rate limiting —Ç–µ—Å—Ç—ã**
   - –ü—Ä–∏—á–∏–Ω–∞: –¢—Ä–µ–±—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ throttler
   - –†–µ—à–µ–Ω–∏–µ: –ü–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `skip` (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–∑–∂–µ)

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- 72 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—à–ª–∏ ‚úÖ
- 8 —Ç–µ—Å—Ç–æ–≤ —É–ø–∞–ª–∏ ‚ùå

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- –û–∂–∏–¥–∞–µ—Ç—Å—è: ~76-78 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥—É—Ç ‚úÖ
- –û—Å—Ç–∞–Ω—É—Ç—Å—è: —Ç–æ–ª—å–∫–æ rate limiting —Ç–µ—Å—Ç—ã (–ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ skip)

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (`auth.exceptions.ts`):
```typescript
export class TwoFactorAlreadyEnabledException extends HttpException {
  constructor(message = '2FA —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞') {
    super(message, HttpStatus.BAD_REQUEST);
  }
}

export class TwoFactorNotEnabledException extends HttpException {
  constructor(message = '2FA –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞') {
    super(message, HttpStatus.BAD_REQUEST);
  }
}

export class TwoFactorSetupExpiredException extends HttpException {
  constructor(message = '–°–µ—Å—Å–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA –∏—Å—Ç–µ–∫–ª–∞...') {
    super(message, HttpStatus.BAD_REQUEST);
  }
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ `auth.service.ts`:
- –ó–∞–º–µ–Ω–µ–Ω—ã `throw new Error()` –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö:
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ password hashes –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ email verification
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Rate limiting —Ç–µ—Å—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `skip`

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Å–ø–µ—à–Ω–æ!

